<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>光散乱シミュレーション</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; }
    .controls { margin: 20px; }
    .color-box {
      width: 300px;
      height: 150px;
      margin: 20px auto;
      border: 2px solid #333;
      background-color: white;
    }
    label { display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>光散乱シミュレーション</h1>

  <div class="controls">
    <label>
      粒径（nm）: <span id="sizeValue">50</span>
      <input type="range" id="sizeSlider" min="10" max="1000" value="50">
    </label>

    <label>
      光の到達距離（容器の高さ）: <span id="distanceValue">100</span>
      <input type="range" id="distanceSlider" min="10" max="500" value="100">
    </label>
  </div>

  <div class="color-box" id="colorBox"></div>

  <script>
    const sizeSlider = document.getElementById("sizeSlider");
    const distanceSlider = document.getElementById("distanceSlider");
    const sizeValue = document.getElementById("sizeValue");
    const distanceValue = document.getElementById("distanceValue");
    const colorBox = document.getElementById("colorBox");

    function wavelengthToRGB(wavelength) {
      // 可視光の波長をRGBに変換（簡易版）
      let R = 0, G = 0, B = 0;
      if (wavelength >= 380 && wavelength < 440) {
        R = -(wavelength - 440) / (440 - 380);
        B = 1;
      } else if (wavelength < 490) {
        G = (wavelength - 440) / (490 - 440);
        B = 1;
      } else if (wavelength < 510) {
        G = 1;
        B = -(wavelength - 510) / (510 - 490);
      } else if (wavelength < 580) {
        R = (wavelength - 510) / (580 - 510);
        G = 1;
      } else if (wavelength < 645) {
        R = 1;
        G = -(wavelength - 645) / (645 - 580);
      } else if (wavelength <= 780) {
        R = 1;
      }
      return [R, G, B];
    }

    function updateColor() {
      const size = parseFloat(sizeSlider.value);
      const distance = parseFloat(distanceSlider.value);
      sizeValue.textContent = size;
      distanceValue.textContent = distance;

      let totalRGB = [0, 0, 0];
      for (let wl = 380; wl <= 780; wl += 5) {
        let intensity;
        if (size < 200) {
          intensity = 1 / Math.pow(wl, 4); // レイリー散乱
        } else {
          intensity = 1; // ミー散乱（波長依存性なし）
        }

        // 距離による減衰（簡易モデル）
        intensity *= Math.exp(-distance / 200);

        const [r, g, b] = wavelengthToRGB(wl);
        totalRGB[0] += r * intensity;
        totalRGB[1] += g * intensity;
        totalRGB[2] += b * intensity;
      }

      // 正規化と色変換
      const max = Math.max(...totalRGB);
      const rgb = totalRGB.map(c => Math.min(255, Math.floor((c / max) * 255)));
      colorBox.style.backgroundColor = `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
    }

    sizeSlider.addEventListener("input", updateColor);
    distanceSlider.addEventListener("input", updateColor);

    updateColor(); // 初期表示
  </script>
</body>
</html>

